<head>
    <title>Placeholder Title</title>
    <script src="../card.js" type="text/javascript"></script>
</head>

<style>
    @font-face {
        font-family: "Handwriting";
        src: url("IndieFlower.ttf");
    }
    @font-face {
        font-family: "Nova";
        src: url("NovaFlat.ttf");
    }

    body {
        -ms-overflow-style: scrollbar;
        -webkit-app-region: drag;
    }
    button {
        -webkit-app-region: no-drag;
    }

    .title {
        font-family: "Handwriting";
        font-size: 42px;
        text-align: center;
        padding: 0px; margin-bottom: -25px;
    }
    .text {
        font-family: "Handwriting";
        font-size: 17px;
        padding: 0px; margin: 10px;
        margin-top: 0px;
    }

    .finish {
        position: absolute;
        right:  0;
        bottom: 0;

        background-color: #b8edad;
        border-width: 0px;
        padding: 10px;
    }
    .edit {
        position: absolute;
        right:  52px;
        bottom: 0;

        background-color: #add3ed;
        border-width: 0px;
        padding: 10px;
    }

    hr {
        border-color: #edaead;
    }

    .iconImg {
        width: 65;
        height: 88px;
    }
</style>

<body>
    <p class="text" id="text">This is a placeholder textreption</p>

    <script>
        const ipc = require('electron').ipcRenderer;
        const showdown = require('showdown');

        var edit = false;
        var identity = null;

        var oldText = "";
        
        document.addEventListener('keydown', event => {
            
            // If tab
            if (event.keyCode == 9) {
                event.preventDefault();
                toggleEdit();
            }
            if (event.keyCode == 8 && !edit) {
                exit();
            }
            if(event.keyCode == 123) {
                ipc.send('toggle-dev-tools', 'dew it');
            }
            // Every key press render the markdown if not edit
            if (!edit) {
                renderText();
            }
        });

        // Assign an identity to the card
        function assign(identity) {
            document.getElementById("text").innerHTML = identity.text;
        }
        
        // Toggle edit mode
        function toggleEdit() {
            if (!edit) {
                var text  = document.getElementById("text");
                
                oldText = oldText.replace(/(?:\r\n|\r|\n)/g, '<br />');
                text.innerHTML = oldText;
                
                text.setAttribute("contentEditable", true);
                text.style.setProperty("-webkit-app-region", "no-drag");
            } else {
                var text  = document.getElementById("text");
                
                text.setAttribute("contentEditable", false);
                text.style.setProperty("-webkit-app-region", "drag");
                
                identity.text  = text.innerHTML;
                assign(identity);
            }
            
            edit = !edit;
        }
        
        // Exit the program
        function exit() {
            if (edit) {
                toggleEdit();
            } else {
                window.close();
            }
        }

        var converter = new showdown.Converter({simpleLineBreaks:true});
        // Render text in the box
        function renderText() {
            var box = document.getElementById("text");
            oldText = box.innerText;

            box.innerHTML = converter.makeHtml(box.innerText);
        }
        
        // Create a new notecard
        function newNotecard() {
            ipc.send("paper-create", "Press tab to enter edit mode");
        }

        // When identity is recived
        ipc.on('identity-assign', (event, message) => {
            identity = new Card(message);
            
            assign(identity);
        });

        </script>
    </body>